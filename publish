#!/usr/bin/env fish

argparse pre-release -- $argv 2>/dev/null
or return 1

if not set -q OPEN_VSX_TOKEN
    echo "OPEN_VSX_TOKEN is not set. Please set it before running this script." >&2
    exit 1
end

if not set -q VSCE_TOKEN
    echo "VSCE_TOKEN is not set. Please set it before running this script." >&2
    exit 1
end

yarn install

if set -ql _flag_pre_release
    npx ovsx publish -p $OPEN_VSX_TOKEN --yarn --pre-release
    npx vsce publish -p $VSCE_TOKEN --yarn --pre-release
else
    npx ovsx publish -p $OPEN_VSX_TOKEN --yarn
    npx vsce publish -p $VSCE_TOKEN --yarn
end
